{"ignition":{"version":"2.0.0","config":{}},"storage":{"filesystems":[{"name":"etc-dnsmasq","mount":{"device":"/dev/matchbox-drewfus-org/etc-dnsmasq","format":"ext4","create":{}}},{"name":"etc-matchbox","mount":{"device":"/dev/matchbox-drewfus-org/etc-matchbox","format":"ext4","create":{}}},{"name":"var-lib-matchbox","mount":{"device":"/dev/matchbox-drewfus-org/var-lib-matchbox","format":"ext4","create":{}}},{"name":"var-lib-tftproot","mount":{"device":"/dev/matchbox-drewfus-org/var-lib-tftproot","format":"ext4","create":{}}}],"files":[{"filesystem":"root","path":"/etc/hostname","contents":{"source":"data:,matchbox.drewfus.org","verification":{}},"mode":420,"user":{},"group":{}},{"filesystem":"root","path":"/var/lib/iptables/rules-save","contents":{"source":"data:,%23%20Generated%20by%20iptables-save%20v1.4.21%20on%20Mon%20Sep%20%204%2018%3A17%3A44%202017%0A*nat%0A%3APREROUTING%20ACCEPT%20%5B3%3A909%5D%0A%3AINPUT%20ACCEPT%20%5B3%3A909%5D%0A%3AOUTPUT%20ACCEPT%20%5B3%3A340%5D%0A%3APOSTROUTING%20ACCEPT%20%5B0%3A0%5D%0A-A%20POSTROUTING%20-o%20enp3s0f0%20-j%20MASQUERADE%0ACOMMIT%0A%23%20Completed%20on%20Mon%20Sep%20%204%2018%3A17%3A44%202017%0A%23%20Generated%20by%20iptables-save%20v1.4.21%20on%20Mon%20Sep%20%204%2018%3A17%3A44%202017%0A*filter%0A%3AINPUT%20ACCEPT%20%5B836%3A58344%5D%0A%3AFORWARD%20ACCEPT%20%5B0%3A0%5D%0A%3AOUTPUT%20ACCEPT%20%5B666%3A162244%5D%0ACOMMIT%0A%23%20Completed%20on%20Mon%20Sep%20%204%2018%3A17%3A44%202017%0A","verification":{}},"mode":420,"user":{},"group":{}},{"filesystem":"etc-dnsmasq","path":"/etc/dnsmasq/dnsmasq.conf","contents":{"source":"data:,interface%3Denp6s0%0Adhcp-match%3Dset%3Aipxe%2C175%0A%0A%23%20if%20request%20comes%20from%20older%20PXE%20ROM%2C%20chainload%20to%20iPXE%20(via%20TFTP)%0Adhcp-boot%3Dtag%3A!ipxe%2Cundionly.kpxe%0A%0A%23%20point%20ipxe%20tagged%20requests%20to%20the%20matchbox%20iPXE%20boot%20script%20(via%20HTTP)%0Adhcp-boot%3Dtag%3Aipxe%2Chttp%3A%2F%2Fmatchbox.drewfus.org%3A8080%2Fboot.ipxe%0A%0A%23%20verbose%0Alog-queries%0Alog-dhcp%0A%0Aenable-tftp%0Atftp-root%3D%2Fvar%2Flib%2Ftftproot%0A%0Adhcp-range%3D172.17.8.32%2C172.17.8.254%2C30m%0A%0A%23%20static%20DNS%20assignements%0Aaddress%3D%2Fmatchbox.drewfus.org%2F172.17.8.1%0Aaddress%3D%2Ffreenas.drewfus.org%2F172.17.8.2%0Aaddress%3D%2Fcore-1.drewfus.org%2F172.17.8.3%0Aaddress%3D%2Fcore-2.drewfus.org%2F172.17.8.4%0Aaddress%3D%2Fcore-3.drewfus.org%2F172.17.8.5%0A%0A%23%20default%20GW%20%5Bnode%20need%20external%20access%20to%20fetch%20containers%5D%0Adhcp-option%3D3%2C172.17.8.1%0A%0A%23%20assign%20fixed%20hostname%20and%20ip%20address%20to%20the%20nodes%0Adhcp-host%3D00%3A23%3A8b%3A17%3A4a%3Add%2Cfreenas.drewfus.org%2C172.17.8.2%2Cinfinite%0A%23dhcp-host%3D00%3A50%3A56%3A20%3AAE%3AA6%2Ccore-1.drewfus.org%2C172.17.8.3%2Cinfinite%0A%23dhcp-host%3D00%3A50%3A56%3A3C%3A0E%3A1A%2Ccore-2.drewfus.org%2C172.17.8.4%2Cinfinite%0A%23dhcp-host%3D00%3A50%3A56%3A3C%3A0E%3A1A%2Ccore-3.drewfus.org%2C172.17.8.5%2Cinfinite%0A","verification":{}},"mode":420,"user":{},"group":{}}]},"systemd":{"units":[{"name":"iptables-restore.service","enable":true},{"name":"lvm2-lvmetad.service","enable":true},{"name":"etc-matchbox.mount","enable":true,"contents":"[Unit]\nDescription=Mount volume for /etc/matchbox\nBefore=matchbox.service\n\n[Mount]\nWhat=/dev/matchbox-drewfus-org/etc-matchbox\nWhere=/etc/matchbox\nType=ext4\n\n[Install]\nWantedBy = multi-user.target\n"},{"name":"var-lib-matchbox.mount","enable":true,"contents":"[Unit]\nDescription=Mount volume for /var/lib/matchbox\nBefore=matchbox.service\n\n[Mount]\nWhat=/dev/matchbox-drewfus-org/var-lib-matchbox\nWhere=/etc/matchbox\nType=ext4\n\n[Install]\nWantedBy = multi-user.target\n"},{"name":"matchbox.service","enable":true,"contents":"[Unit]\nDescription=CoreOS matchbox Server\nDocumentation=https://github.com/coreos/matchbox\nRequires=network-online.target\nAfter=network-online.target etc-matchbox.mount var-lib-matchbox.mount\n\n[Service]\nSlice=machine.slice\nKillMode=mixed\nEnvironment=\"IMAGE=quay.io/coreos/matchbox\"\nEnvironment=\"VERSION=v0.6.1\"\nEnvironment=\"MATCHBOX_ADDRESS=0.0.0.0:8080\"\nEnvironment=\"MATCHBOX_RPC_ADDRESS=0.0.0.0:8081\"\nEnvironment=\"MATCHBOX_LOG_LEVEL=debug\"\nExecStartPre=/usr/bin/mkdir -p /var/lib/matchbox/assets\nExecStart=/usr/bin/rkt run \\\n  --net=host \\\n  --inherit-env \\\n  --trust-keys-from-https \\\n  --mount volume=data,target=/var/lib/matchbox \\\n  --mount volume=config,target=/etc/matchbox \\\n  --volume data,kind=host,source=/var/lib/matchbox \\\n  --volume config,kind=host,source=/etc/matchbox \\\n  ${IMAGE}:${VERSION}\nExecStopPost=/usr/bin/rkt gc --mark-only\nRestart=always\n\n[Install]\nWantedBy=multi-user.target\n"},{"name":"etc-dnsmasq.mount","enable":true,"contents":"[Unit]\nDescription=Mount volume for /etc/dnsmasq\nBefore=dnsmasq.service\n\n[Mount]\nWhat=/dev/matchbox-drewfus-org/etc-dnsmasq\nWhere=/etc/dnsmasq\nType=ext4\n\n[Install]\nWantedBy = multi-user.target\n"},{"name":"var-lib-tftproot.mount","enable":true,"contents":"[Unit]\nDescription=Mount volume for /var/lib/tftproot\nBefore=dnsmasq.service\n\n[Mount]\nWhat=/dev/matchbox-drewfus-org/var-lib-tftproot\nWhere=/var/lib/tftproot\nType=ext4\n\n[Install]\nWantedBy = multi-user.target\n"},{"name":"dnsmasq.service","enable":true,"contents":"[Unit]\nDescription=dnsmasq\n# Wait for networking\nRequires=network-online.target\nAfter=network-online.target etc-dnsmasq.mount var-lib-tftproot.mount\n\n[Service]\nSlice=machine.slice\nKillMode=mixed\nEnvironment=\"IMAGE=quay.io/coreos/dnsmasq\"\nEnvironment=\"VERSION=v0.4.1\"\nExecStartPre=/usr/bin/wget -nc -q -O \"/var/lib/tftproot/undionly.kpxe\" \"http://boot.ipxe.org/undionly.kpxe\"\nExecStartPre=cp /var/lib/tftproot/undionly.kpxe /var/lib/tftproot/undionly.kpxe.0\nExecStart=/usr/bin/rkt run \\\n  --hostname=matchbox.drewfus.org \\\n  --net=host \\\n  --inherit-env \\\n  --trust-keys-from-https \\\n  --volume etc-dnsmasq,kind=host,source=/etc/dnsmasq \\\n  --volume tftproot,kind=host,source=/var/lib/tftproot \\\n  --mount volume=etc-dnsmasq,target=/etc/dnsmasq \\\n  --mount volume=tftproot,target=/var/lib/tftproot \\\n  ${IMAGE}:${VERSION} \\\n  -- -d -C /etc/dnsmasq/dnsmasq.conf -R -S 8.8.8.8\nExecStopPost=/usr/bin/rkt gc --mark-only\nRestart=always\n\n[Install]\nWantedBy=multi-user.target\n"}]},"networkd":{"units":[{"name":"10-static.network","contents":"[Match]\nName=enp6s0\n\n[Network]\nAddress=172.17.8.1/24\nGateway=192.168.1.1\n"},{"name":"20-dhcp.network","contents":"[Match]\nName=enp3s0f0\n\n[Network]\nDHCP=yes\n"}]},"passwd":{"users":[{"name":"core","sshAuthorizedKeys":["ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDIEsyW+6KxtNl3iAjSrHeRSlZh3AnaWtDM7zO/G2dAAMl/fnYeWiFOAzYKOYC5crnK3U3CscY3IIy0HYNZ5TvIRNbzamn8bn7ThTw01QJJG0qH4xJ1w3qBtOWGC4xumMg1FXAg0Qa057jMsRkepWoqLfqSyJn6f9eJ1SqK6my8AKSoCxt6fgY8xNeNAXvODKkRLl2sf5h3dRPM7RvoGCr3KNraMsGRP7qI6sEoHlrMEz06rV8hm0+FtM2Nypxzjm505zAWwmvbhq79nGEGxONqyQJs/r7noSKYNZ6tq2r6qdtISebxg+pd5YQ7nX0vSdae+togYWrpVkRTkX66LScROGMVD1YSDHVfcQRKWvkO80HWvJuVWM8uWFsQIXTiC6NnP2Q5p+/RKYOQ1/5TewSYGlY+ErAiv8rxDXhs21S/rp80Fyd/hezKUs0fm0Te8gGZrYlVpieDHDf7q6Yp4zGCeA0nfzMYoaqDGwHeeg7KHQrY3kw66xu0VMa7x9tfgPGWjYY1z2Pb53dctd/PRI7GMmdZ1UVkvNJha2DdqGxh6kAH+idHZ9uF6PW2F7DecHCTipKEb64lHa2Bn8RUmJIN6gU1+YPZgA2nH75W2Y9QWwch5ekq+LA19atbZn6u6qTXx3pGJWKVmAg6p6ugJc1OJLPqkkKHkov5fhRcIrcMbQ== drew@Andrews-MacBook-Pro-2.local"]}]}}